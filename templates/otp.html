<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verify OTP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#0f1724;--accent:#5865F2;--muted:#94a3b8;--card:#111827
        }
        body{font-family:Inter,system-ui,Arial;background:linear-gradient(135deg,var(--bg),#071028);color:#e6edf3;min-height:100vh;display:flex;align-items:center;justify-content:center}
        .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border-radius:12px;padding:28px;width:420px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
        h2{color:var(--accent);margin-bottom:6px}
        .otp-input{letter-spacing:8px;font-size:22px;text-align:center;padding:12px;border-radius:10px;background:#0b1220;border:1px solid rgba(255,255,255,0.04);color:#fff}
        .hint{color:var(--muted);font-size:13px}
        .pulse{animation:pulse 2s infinite}
        @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
    </style>
</head>
<body>
    <div class="card">
        <h2>Two-Factor Authentication</h2>
        <p class="hint">Enter the 6-digit code sent to your device. This demo prints the code server-side.</p>

        <form id="otpForm" method="POST">
            <input name="otp" id="otpInput" class="otp-input" inputmode="numeric" maxlength="6" autocomplete="one-time-code" required>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <small id="countdown" class="hint">00:60</small>
                <div>
                    <button id="resendBtn" type="button" class="btn btn-sm btn-outline-light">Resend</button>
                    <button type="submit" class="btn btn-sm btn-primary ms-2">Verify</button>
                </div>
            </div>
        </form>

        <div class="mt-3 text-muted" style="font-size:13px">Troubleshooting: check server console for demo OTP. For production, integrate SMS/email/TOTP.</div>
    </div>

    <script>
        const ttl = {{ ttl }}; // seconds
        let expires = Date.now() + ttl*1000;
        const cd = document.getElementById('countdown');
        const resendBtn = document.getElementById('resendBtn');

        function update(){
            let rem = Math.max(0, Math.floor((expires - Date.now())/1000));
            let m = String(Math.floor(rem/60)).padStart(2,'0');
            let s = String(rem%60).padStart(2,'0');
            cd.textContent = `${m}:${s}`;
            if(rem===0) cd.textContent='Expired';
        }
        setInterval(update,250);
        update();

        resendBtn.addEventListener('click', async ()=>{
            resendBtn.disabled = true;
            const r = await fetch('/otp/resend',{method:'POST'});
            if(!r.ok){
                const j = await r.json().catch(()=>({error:'failed'}));
                alert(j.error || 'Cannot resend now');
            } else {
                expires = Date.now() + ttl*1000;
                update();
            }
            setTimeout(()=>resendBtn.disabled=false,2000);
        });

        // allow paste and auto-submit for 6 digits
        const otpInput = document.getElementById('otpInput');
        otpInput.addEventListener('input', ()=>{
            if(otpInput.value.length===6) document.getElementById('otpForm').requestSubmit();
        });
    </script>
</body>
</html>
